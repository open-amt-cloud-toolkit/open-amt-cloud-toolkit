{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]"
    },
    "containerStackName": {
      "type": "string",
      "defaultValue": "open-amt-cloud-toolkit"
    },
    "registry": {
      "type": "string",
      "metadata": {
        "description": "Name of the Registry."
      }
    },
    "registryUsername": {
      "type": "securestring",
      "metadata": {
        "description": "Username for the registry"
      }
    },
    "registryPassword": {
      "type": "securestring",
      "metadata": {
        "description": "Password for the registry"
      }
    },
    "vaultToken": {
      "defaultValue": "myroot",
      "type": "securestring"
    },
    "rpsImageName": {
      "defaultValue": "rps:latest",
      "type": "string",
      "metadata": {
        "description": "Name of the RPS image to deploy from specified registry"
      }
    },
    "mpsImageName": {
      "defaultValue": "mps:latest",
      "type": "string",
      "metadata": {
        "description": "Name of the MPS image to deploy from specified registry"
      }
    },
    "sampleWebUIImageName": {
      "defaultValue": "webui:latest",
      "type": "string",
      "metadata": {
        "description": "Name of the Sample WebUI image to deploy from specified registry"
      }
    },
    "fqdn": {
      "type": "string",
      "metadata": {
        "description": "Name of the FQDN you wish to use to access this deployment (i.e. \"sample\" will result in an FQDN of sample.westus.azurecontainer.io)"
      }
    },
    "authEnabled": {
      "defaultValue": "false",
      "type": "string",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "corsHeaders": {
      "defaultValue": "Origin, X-Requested-With, Accept, X-MPS-API-Key,x-rps-api-key, Content-Type, csrf-token, authorization",
      "type": "string",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "useAllowlist": {
      "defaultValue": "false",
      "type": "string",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsAdminUsername": {
      "defaultValue": "standalone",
      "type": "securestring",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsAdminPassword": {
      "defaultValue": "G@ppm0ym",
      "type": "securestring",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsUsername": {
      "defaultValue": "standalone",
      "type": "securestring",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsPassword": {
      "defaultValue": "G@ppm0ym",
      "type": "securestring",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsSessionEncryptionKey": {
      "defaultValue": "<YourStrongSessionEncryptionKey123!>",
      "type": "securestring",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsXAPIKey": {
      "defaultValue": "APIKEYFORMPS123!",
      "type": "string",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "rpsXAPIKey": {
      "defaultValue": "APIKEYFORRPS123!",
      "type": "string",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    }
  },
  "resources": [
    {
      "type": "Microsoft.ContainerInstance/containerGroups",
      "apiVersion": "2019-12-01",
      "name": "[parameters('containerStackName')]",
      "location": "[parameters('location')]",
      "properties": {
        "sku": "Standard",
        "containers": [
          {
            "name": "rps",
            "properties": {
              "image": "[concat(parameters('registry'), '/', parameters('rpsImageName'))]",
              "ports": [
                {
                  "port": 8080
                },
                {
                  "port": 8081
                }
              ],
              "environmentVariables": [
                {
                  "name": "RPS_WEB_TLS_CERT",
                  "value": "../private/mpsserver-cert-public.crt"
                },
                {
                  "name": "RPS_WEB_TLS_CERT_KEY",
                  "value": "../private/mpsserver-cert-private.key"
                },
                {
                  "name": "RPS_ROOT_CA_CERT",
                  "value": "../private/root-cert-public.crt"
                },
                {
                  "name": "RPS_CORS_ORIGIN",
                  "value": "[concat('https://',parameters('fqdn'), '.', parameters('location'),'.azurecontainer.io')]"
                },
                {
                  "name": "RPS_CORS_HEADERS",
                  "value": "[parameters('corsHeaders')]"
                },
                {
                  "name": "RPS_XAPIKEY",
                  "value": "[parameters('rpsXAPIKey')]"
                },
                {
                  "name": "RPS_USER",
                  "value": "[parameters('mpsUsername')]"
                },
                {
                  "name": "RPS_PASSWORD",
                  "value": "[parameters('mpsPassword')]"
                },
                {
                  "name": "RPS_CORS_ALLOW_CREDENTIALS",
                  "value": "true"
                },
                {
                  "name": "RPS_MPS_SERVER",
                  "value": "https://127.0.0.1:3000"
                }
              ],
              "command": [
                "/bin/bash",
                "-c",
                "while ! nc -z localhost 3000;\ndo\necho waiting for mps;\nsleep 5;\ndone;\necho MPS Running!;\nnode ./dist/Index.js;"
              ],
              "volumeMounts": [
                {
                  "name": "private",
                  "mountPath": "/rcs-microservice/private"
                }
              ],
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              }
            }
          },
          {
            "name": "mps",
            "properties": {
              "image": "[concat(parameters('registry'), '/', parameters('mpsImageName'))]",
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              },
              "environmentVariables": [
                {
                  "name": "MPS_COMMON_NAME",
                  "value": "[concat(parameters('fqdn'), '.', parameters('location'),'.azurecontainer.io')]"
                },
                {
                  "name": "MPS_CORS_ORIGIN",
                  "value": "[concat('https://',parameters('fqdn'), '.', parameters('location'),'.azurecontainer.io')]"
                },
                {
                  "name": "MPS_CORS_HEADERS",
                  "value": "[parameters('corsHeaders')]"
                },
                {
                  "name": "MPS_AUTH_ENABLED",
                  "value": "[parameters('authEnabled')]"
                },
                {
                  "name": "MPS_USE_ALLOWLIST",
                  "value": "[parameters('useAllowlist')]"
                },
                {
                  "name": "MPS_XAPIKEY",
                  "value": "[parameters('mpsXAPIKey')]"
                },
                {
                  "name": "MPS_WEB_ADMIN_USER",
                  "value": "[parameters('mpsAdminUsername')]"
                },
                {
                  "name": "MPS_WEB_ADMIN_PASSWORD",
                  "value": "[parameters('mpsAdminPassword')]"
                },
                {
                  "name": "MPS_USERNAME",
                  "value": "[parameters('mpsUsername')]"
                },
                {
                  "name": "MPS_PASS",
                  "value": "[parameters('mpsPassword')]"
                },
                {
                  "name": "MPS_USE_DB",
                  "value": "true"
                }
              ],
              "ports": [
                {
                  "port": 4433
                },
                {
                  "port": 3000
                }
              ],
              "volumeMounts": [
                {
                  "name": "private",
                  "mountPath": "/mps-microservice/private"
                }
              ]
            }
          },
          {
            "name": "webui",
            "properties": {
              "image": "[concat(parameters('registry'), '/', parameters('sampleWebUIImageName'))]",
              "ports": [
                {
                  "port": 443
                }
              ],
              "environmentVariables": [
                {
                  "name": "MPS_SERVER",
                  "value": "[concat('https://',parameters('fqdn'), '.', parameters('location'), '.azurecontainer.io:3000')]"
                },
                {
                  "name": "RPS_SERVER",
                  "value": "[concat('https://',parameters('fqdn'), '.', parameters('location'), '.azurecontainer.io:8081')]"
                },
                {
                  "name": "MPSXAPIKEY",
                  "value": "[parameters('mpsXAPIKey')]"
                },
                {
                  "name": "RPSXAPIKEY",
                  "value": "[parameters('rpsXAPIKey')]"
                },
                {
                  "name": "AUTH_MODE_ENABLED",
                  "value": "[parameters('authEnabled')]"
                }
              ],
              "volumeMounts": [
                {
                  "name": "private",
                  "mountPath": "/etc/nginx/certs"
                },
                {
                  "name": "nginx-config",
                  "mountPath": "/etc/nginx/conf.d"
                }
              ],
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              }
            }
          },
          {
            "name": "vault",
            "properties": {
              "image": "vault:latest",
              "environmentVariables": [
                {
                  "name": "VAULT_DEV_ROOT_TOKEN_ID",
                  "value": "[parameters('vaultToken')]"
                },
                {
                  "name": "VAULT_DEV_LISTEN_ADDRESS",
                  "value": "0.0.0.0:8200"
                }
              ],
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              }
            }
          },
          {
            "name": "rpsdb",
            "properties": {
              "image": "postgres:latest",
              "ports": [
                {
                  "port": 5432
                }
              ],
              "environmentVariables": [
                {
                  "name": "POSTGRES_DB",
                  "value": "rpsdb"
                },
                {
                  "name": "POSTGRES_USER",
                  "value": "postgresadmin"
                },
                {
                  "name": "POSTGRES_PASSWORD",
                  "value": "admin123"
                }
              ],
              "volumeMounts": [
                {
                  "name": "db-config",
                  "mountPath": "/docker-entrypoint-initdb.d"
                }
              ],
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              }
            }
          }
        ],
        "osType": "Linux",
        "restartPolicy": "OnFailure",
        "imageRegistryCredentials": [
          {
            "server": "[parameters('registry')]",
            "username": "[parameters('registryUsername')]",
            "password": "[parameters('registryPassword')]"
          }
        ],
        "ipAddress": {
          "ip": "168.61.3.88",
          "dnsNameLabel": "[parameters('fqdn')]",
          "type": "Public",
          "ports": [
            {
              "protocol": "tcp",
              "port": 8080
            },
            {
              "protocol": "tcp",
              "port": 8081
            },
            {
              "protocol": "tcp",
              "port": 4433
            },
            {
              "protocol": "tcp",
              "port": 3000
            },
            {
              "protocol": "tcp",
              "port": 443
            }
          ]
        },
        "volumes": [
          {
            "name": "db-config",
            "secret": {
              "init.sql": "Q1JFQVRFIEVYVEVOU0lPTiBJRiBOT1QgRVhJU1RTIGNpdGV4dDsKQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgY2lyYWNvbmZpZ3MoCiAgICAgIGNpcmFfY29uZmlnX25hbWUgY2l0ZXh0IE5PVCBOVUxMLAogICAgICBtcHNfc2VydmVyX2FkZHJlc3MgdmFyY2hhcigyNTYpLAogICAgICBtcHNfcG9ydCBpbnRlZ2VyLAogICAgICB1c2VyX25hbWUgdmFyY2hhcig0MCksCiAgICAgIHBhc3N3b3JkIHZhcmNoYXIoNjMpLAogICAgICBjb21tb25fbmFtZSB2YXJjaGFyKDI1NiksCiAgICAgIHNlcnZlcl9hZGRyZXNzX2Zvcm1hdCBpbnRlZ2VyLCAKICAgICAgYXV0aF9tZXRob2QgaW50ZWdlciwgCiAgICAgIG1wc19yb290X2NlcnRpZmljYXRlIHRleHQsIAogICAgICBwcm94eWRldGFpbHMgdGV4dCwKICAgICAgQ09OU1RSQUlOVCBjb25maWduYW1lIFVOSVFVRShjaXJhX2NvbmZpZ19uYW1lKQogICAgKTsKQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgbmV0d29ya2NvbmZpZ3MoCiAgICAgIG5ldHdvcmtfcHJvZmlsZV9uYW1lIGNpdGV4dCBOT1QgTlVMTCwKICAgICAgZGhjcF9lbmFibGVkIEJPT0xFQU4gTk9UIE5VTEwsCiAgICAgIHN0YXRpY19pcF9zaGFyZWQgQk9PTEVBTiBOT1QgTlVMTCwKICAgICAgaXBfc3luY19lbmFibGVkIEJPT0xFQU4gTk9UIE5VTEwsCiAgICAgIENPTlNUUkFJTlQgbmV0d29ya3Byb2ZpbGVuYW1lIFVOSVFVRShuZXR3b3JrX3Byb2ZpbGVfbmFtZSkKICAgICk7CkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHByb2ZpbGVzKAogICAgICBwcm9maWxlX25hbWUgY2l0ZXh0IE5PVCBOVUxMLAogICAgICBhY3RpdmF0aW9uIHZhcmNoYXIoMjApIE5PVCBOVUxMLAogICAgICBhbXRfcGFzc3dvcmQgdmFyY2hhcig0MCksCiAgICAgIGNvbmZpZ3VyYXRpb25fc2NyaXB0IHRleHQsCiAgICAgIGNpcmFfY29uZmlnX25hbWUgY2l0ZXh0IFJFRkVSRU5DRVMgY2lyYWNvbmZpZ3MoY2lyYV9jb25maWdfbmFtZSksCiAgICAgIGdlbmVyYXRlX3JhbmRvbV9wYXNzd29yZCBCT09MRUFOIE5PVCBOVUxMLAogICAgICByYW5kb21fcGFzc3dvcmRfY2hhcmFjdGVycyB2YXJjaGFyKDEwMCksCiAgICAgIHJhbmRvbV9wYXNzd29yZF9sZW5ndGggaW50ZWdlciwKICAgICAgY3JlYXRpb25fZGF0ZSB0aW1lc3RhbXAsCiAgICAgIGNyZWF0ZWRfYnkgdmFyY2hhcig0MCksCiAgICAgIG5ldHdvcmtfcHJvZmlsZV9uYW1lIGNpdGV4dCBSRUZFUkVOQ0VTIG5ldHdvcmtjb25maWdzKG5ldHdvcmtfcHJvZmlsZV9uYW1lKSwKICAgICAgbWVieF9wYXNzd29yZCB2YXJjaGFyKDQwKSwKICAgICAgZ2VuZXJhdGVfcmFuZG9tX21lYnhfcGFzc3dvcmQgQk9PTEVBTiBOT1QgTlVMTCwKICAgICAgcmFuZG9tX21lYnhfcGFzc3dvcmRfbGVuZ3RoIGludGVnZXIsCiAgICAgIHRhZ3MgdGV4dFtdLAogICAgICBDT05TVFJBSU5UIG5hbWUgVU5JUVVFKHByb2ZpbGVfbmFtZSkKICAgICk7CkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGRvbWFpbnMoCiAgICAgIG5hbWUgY2l0ZXh0IE5PVCBOVUxMLAogICAgICBkb21haW5fc3VmZml4IGNpdGV4dCBOT1QgTlVMTCwKICAgICAgcHJvdmlzaW9uaW5nX2NlcnQgdGV4dCwKICAgICAgcHJvdmlzaW9uaW5nX2NlcnRfc3RvcmFnZV9mb3JtYXQgdmFyY2hhcig0MCksCiAgICAgIHByb3Zpc2lvbmluZ19jZXJ0X2tleSB0ZXh0LAogICAgICBjcmVhdGlvbl9kYXRlIHRpbWVzdGFtcCwKICAgICAgY3JlYXRlZF9ieSB2YXJjaGFyKDQwKSwKICAgICAgQ09OU1RSQUlOVCBkb21haW5uYW1lIFVOSVFVRShuYW1lKSwKICAgICAgQ09OU1RSQUlOVCBkb21haW5zdWZmaXggVU5JUVVFKGRvbWFpbl9zdWZmaXgpCiAgICApOwpDUkVBVEUgVU5JUVVFIElOREVYIGxvd2VyX2NpcmFfY29uZmlnX25hbWVfaWR4IE9OIGNpcmFjb25maWdzICgobG93ZXIoY2lyYV9jb25maWdfbmFtZSkpKTsKQ1JFQVRFIFVOSVFVRSBJTkRFWCBsb3dlcl9uZXR3b3JrX3Byb2ZpbGVfbmFtZV9pZHggT04gbmV0d29ya2NvbmZpZ3MgKChsb3dlcihuZXR3b3JrX3Byb2ZpbGVfbmFtZSkpKTsKQ1JFQVRFIFVOSVFVRSBJTkRFWCBsb3dlcl9wcm9maWxlX25hbWVfaWR4IE9OIHByb2ZpbGVzICgobG93ZXIocHJvZmlsZV9uYW1lKSkpOwpDUkVBVEUgVU5JUVVFIElOREVYIGxvd2VyX25hbWVfc3VmZml4X2lkeCBPTiBkb21haW5zICgobG93ZXIobmFtZSkpLCAobG93ZXIoZG9tYWluX3N1ZmZpeCkpKTsKSU5TRVJUIElOVE8gcHVibGljLm5ldHdvcmtjb25maWdzKAogIG5ldHdvcmtfcHJvZmlsZV9uYW1lLCBkaGNwX2VuYWJsZWQsIHN0YXRpY19pcF9zaGFyZWQsIGlwX3N5bmNfZW5hYmxlZCkgCiAgdmFsdWVzKCdkaGNwX2Rpc2FibGVkJywgZmFsc2UsIHRydWUsIHRydWUpOwpJTlNFUlQgSU5UTyBwdWJsaWMubmV0d29ya2NvbmZpZ3MoCiAgbmV0d29ya19wcm9maWxlX25hbWUsIGRoY3BfZW5hYmxlZCwgc3RhdGljX2lwX3NoYXJlZCwgaXBfc3luY19lbmFibGVkKSAgCiAgdmFsdWVzKCdkaGNwX2VuYWJsZWQnLCB0cnVlLCBmYWxzZSwgdHJ1ZSk7CkNSRUFURSBEQVRBQkFTRSBtcHNkYjsKClxjb25uZWN0IG1wc2RiCgpDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBkZXZpY2VzKAogICAgICBndWlkIHV1aWQgTk9UIE5VTEwsCiAgICAgIHRhZ3MgdGV4dFtdLAogICAgICBob3N0bmFtZSB2YXJjaGFyKDI1NiksCiAgICAgIENPTlNUUkFJTlQgZGV2aWNlX2d1aWQgVU5JUVVFKGd1aWQpCiAgICApOyA="
            }
          },
          {
            "name": "nginx-config",
            "secret": {
              "nginx.conf": "c2VydmVyIHsKICAgIGxpc3RlbiA4MCBkZWZhdWx0X3NlcnZlcjsKICAgIGxpc3RlbiBbOjpdOjgwIGRlZmF1bHRfc2VydmVyOwogICAgc2VydmVyX25hbWUgXzsKICAgIHJldHVybiAzMDcgaHR0cHM6Ly8kaG9zdCRyZXF1ZXN0X3VyaTsKfQoKc2VydmVyIHsKICAgIGxpc3RlbiBbOjpdOjQ0MyBzc2w7CiAgICBsaXN0ZW4gICAgICAgICAgNDQzIHNzbDsKCiAgICAgICAgIyBQcm90ZWN0IGFnYWluc3QgdGhlIEJFQVNUIGF0dGFjayBieSBub3QgdXNpbmcgU1NMdjMgYXQgYWxsLiBJZiB5b3UgbmVlZCB0byBzdXBwb3J0IG9sZGVyIGJyb3dzZXJzIChJRTYpIHlvdSBtYXkgbmVlZCB0byBhZGQKICAgICMgU1NMdjMgdG8gdGhlIGxpc3Qgb2YgcHJvdG9jb2xzIGJlbG93LgogICAgc3NsX3Byb3RvY29scyAgIFRMU3YxLjI7CgogICAgc2VydmVyX25hbWUgICAgIGxvY2FsaG9zdDsKICAgIAogICAgIyBDaXBoZXJzIHNldCB0byBiZXN0IGFsbG93IHByb3RlY3Rpb24gZnJvbSBCZWFzdCwgd2hpbGUgcHJvdmlkaW5nIGZvcndhcmRpbmcgc2VjcmVjeSwgYXMgZGVmaW5lZCBieSBNb3ppbGxhIC0gaHR0cHM6Ly93aWtpLm1vemlsbGEub3JnL1NlY3VyaXR5L1NlcnZlcl9TaWRlX1RMUyNOZ2lueAogICAgc3NsX2NpcGhlcnMgICAgICAgICAgICAgICAgRUNESEUtUlNBLUFFUzEyOC1HQ00tU0hBMjU2OkVDREhFLUVDRFNBLUFFUzEyOC1HQ00tU0hBMjU2OkVDREhFLVJTQS1BRVMyNTYtR0NNLVNIQTM4NDpFQ0RIRS1FQ0RTQS1BRVMyNTYtR0NNLVNIQTM4NDpESEUtUlNBLUFFUzEyOC1HQ00tU0hBMjU2OkRIRS1EU1MtQUVTMTI4LUdDTS1TSEEyNTY6a0VESCtBRVNHQ006RUNESEUtUlNBLUFFUzEyOC1TSEEyNTY6RUNESEUtRUNEU0EtQUVTMTI4LVNIQTI1NjpFQ0RIRS1SU0EtQUVTMTI4LVNIQTpFQ0RIRS1FQ0RTQS1BRVMxMjgtU0hBOkVDREhFLVJTQS1BRVMyNTYtU0hBMzg0OkVDREhFLUVDRFNBLUFFUzI1Ni1TSEEzODQ6RUNESEUtUlNBLUFFUzI1Ni1TSEE6RUNESEUtRUNEU0EtQUVTMjU2LVNIQTpESEUtUlNBLUFFUzEyOC1TSEEyNTY6REhFLVJTQS1BRVMxMjgtU0hBOkRIRS1EU1MtQUVTMTI4LVNIQTI1NjpESEUtUlNBLUFFUzI1Ni1TSEEyNTY6REhFLURTUy1BRVMyNTYtU0hBOkRIRS1SU0EtQUVTMjU2LVNIQTpBRVMxMjgtR0NNLVNIQTI1NjpBRVMyNTYtR0NNLVNIQTM4NDpFQ0RIRS1SU0EtUkM0LVNIQTpFQ0RIRS1FQ0RTQS1SQzQtU0hBOkFFUzEyODpBRVMyNTY6UkM0LVNIQTpISUdIOiFhTlVMTDohZU5VTEw6IUVYUE9SVDohREVTOiEzREVTOiFNRDU6IVBTSzsKICAgIHNzbF9wcmVmZXJfc2VydmVyX2NpcGhlcnMgIG9uOwoKICAgICMgT3B0aW1pemUgU1NMIGJ5IGNhY2hpbmcgc2Vzc2lvbiBwYXJhbWV0ZXJzIGZvciAxMCBtaW51dGVzLiBUaGlzIGN1dHMgZG93biBvbiB0aGUgbnVtYmVyIG9mIGV4cGVuc2l2ZSBTU0wgaGFuZHNoYWtlcy4KICAgICMgVGhlIGhhbmRzaGFrZSBpcyB0aGUgbW9zdCBDUFUtaW50ZW5zaXZlIG9wZXJhdGlvbiwgYW5kIGJ5IGRlZmF1bHQgaXQgaXMgcmUtbmVnb3RpYXRlZCBvbiBldmVyeSBuZXcvcGFyYWxsZWwgY29ubmVjdGlvbi4KICAgICMgQnkgZW5hYmxpbmcgYSBjYWNoZSAob2YgdHlwZSAic2hhcmVkIGJldHdlZW4gYWxsIE5naW54IHdvcmtlcnMiKSwgd2UgdGVsbCB0aGUgY2xpZW50IHRvIHJlLXVzZSB0aGUgYWxyZWFkeSBuZWdvdGlhdGVkIHN0YXRlLgogICAgIyBGdXJ0aGVyIG9wdGltaXphdGlvbiBjYW4gYmUgYWNoaWV2ZWQgYnkgcmFpc2luZyBrZWVwYWxpdmVfdGltZW91dCwgYnV0IHRoYXQgc2hvdWxkbid0IGJlIGRvbmUgdW5sZXNzIHlvdSBzZXJ2ZSBwcmltYXJpbHkgSFRUUFMuCiAgICBzc2xfc2Vzc2lvbl9jYWNoZSAgICBzaGFyZWQ6U1NMOjEwbTsgIyBhIDFtYiBjYWNoZSBjYW4gaG9sZCBhYm91dCA0MDAwIHNlc3Npb25zLCBzbyB3ZSBjYW4gaG9sZCA0MDAwMCBzZXNzaW9ucwogICAgc3NsX3Nlc3Npb25fdGltZW91dCAgMjRoOwoKICAgICMgVXNlIGEgaGlnaGVyIGtlZXBhbGl2ZSB0aW1lb3V0IHRvIHJlZHVjZSB0aGUgbmVlZCBmb3IgcmVwZWF0ZWQgaGFuZHNoYWtlcwogICAga2VlcGFsaXZlX3RpbWVvdXQgMzAwOyAjIHVwIGZyb20gNzUgc2VjcyBkZWZhdWx0CgogICAgaW5kZXggaW5kZXguaHRtbDsKCiAgICBzc2xfY2VydGlmaWNhdGUgICAgICAvZXRjL25naW54L2NlcnRzL21wc3NlcnZlci1jZXJ0LXB1YmxpYy5jcnQ7CiAgICBzc2xfY2VydGlmaWNhdGVfa2V5ICAvZXRjL25naW54L2NlcnRzL21wc3NlcnZlci1jZXJ0LXByaXZhdGUua2V5OwoKICAgICNjaGFyc2V0IGtvaTgtcjsKICAgICNhY2Nlc3NfbG9nICAvdmFyL2xvZy9uZ2lueC9ob3N0LmFjY2Vzcy5sb2cgIG1haW47CgogICAgbG9jYXRpb24gLyB7CiAgICAgICAgcm9vdCAgIC91c3Ivc2hhcmUvbmdpbngvaHRtbDsKICAgICAgICBpbmRleCAgaW5kZXguaHRtbCBpbmRleC5odG07CiAgICB9CgogICAgZXJyb3JfcGFnZSAgNDA0ICAgICAgICAgICAgICAvaW5kZXguaHRtbDsKCiAgICAjIHJlZGlyZWN0IHNlcnZlciBlcnJvciBwYWdlcyB0byB0aGUgc3RhdGljIHBhZ2UgLzUweC5odG1sCiAgICAjCiAgICBlcnJvcl9wYWdlICAgNTAwIDUwMiA1MDMgNTA0ICAvNTB4Lmh0bWw7CiAgICBsb2NhdGlvbiA9IC81MHguaHRtbCB7CiAgICAgICAgcm9vdCAgIC91c3Ivc2hhcmUvbmdpbngvaHRtbDsKICAgIH0KCn0KCg=="
            }
          },
          {
            "name": "private",
            "emptyDir": {}
          }
        ]
      }
    }
  ]
}